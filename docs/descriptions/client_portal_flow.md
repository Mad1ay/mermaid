# UC-FR6.1.10: Онлайн-особистий кабінет клієнта

## Загальна інформація

- **ID:** UC-FR6.1.10
- **Назва:** Онлайн-особистий кабінет клієнта
- **Актори:** Клієнт
- **Платформи:** Веб-сайт, Мобільний додаток
- **Тип:** Use Case

## Опис

Надання клієнтам самостійного доступу до їх профілю, історії візитів та покупок, балансів депозиту та бонусів, бронювань та фіскальних чеків через веб-сайт або мобільний додаток. Особистий кабінет забезпечує прозорість взаємовідносин, зручність самообслуговування та покращує клієнтський досвід.

## Передумови

- Клієнт має доступ до інтернету
- Веб-портал/мобільний додаток розроблено та функціонує
- Існує API-інтеграція між порталом та основною системою управління
- Клієнт зареєстрований у системі (має профіль)

## Основні сценарії

---

## Сценарій 1: Реєстрація нового користувача

### Опис
Новий клієнт створює обліковий запис для доступу до особистого кабінету.

### Послідовність дій

#### 1. Ініціація реєстрації

**Клієнт:**
1. Відкриває веб-сайт або мобільний додаток
2. Обирає опцію "Реєстрація" / "Створити обліковий запис"
3. Система відображає форму реєстрації

#### 2. Заповнення форми реєстрації

**Поля форми:**
- **Ім'я та Прізвище** (обов'язкове)
- **Номер телефону** (обов'язкове, для SMS-верифікації)
- **Email** (обов'язкове або опціональне)
- **Дата народження** (опціональне)
- **Пароль** (обов'язкове, мінімальні вимоги до складності)
- **Підтвердження пароля** (обов'язкове)
- **Згода з умовами використання** (обов'язкове)

**Клієнт:**
1. Заповнює всі обов'язкові поля
2. Створює надійний пароль
3. Погоджується з умовами використання
4. Натискає "Зареєструватися"

#### 3. Валідація даних

**Система перевіряє:**
- Формат номера телефону
- Формат email
- Унікальність номера телефону (чи не зареєстрований раніше)
- Відповідність паролів
- Складність пароля (довжина, спецсимволи)

**Якщо є помилки:**
- Відображає повідомлення про помилки
- Вказує, які поля потребують виправлення
- Клієнт виправляє дані та повторює

#### 4. Верифікація телефону

**Система:**
1. Генерує одноразовий код підтвердження (4-6 цифр)
2. Надсилає SMS на вказаний номер телефону
3. Відображає екран введення коду
4. Вказує термін дії коду (наприклад, 5 хвилин)

**Клієнт:**
1. Отримує SMS з кодом
2. Вводить код у відповідне поле
3. Натискає "Підтвердити"

**Можливості:**
- Повторне відправлення коду (через 60 секунд)
- Відміна та повернення до форми реєстрації

#### 5. Створення профілю

**Якщо код вірний:**

**Система:**
1. Створює обліковий запис користувача
2. Зв'язує з існуючим профілем клієнта (якщо номер телефону вже є в базі)
3. Або створює новий профіль клієнта
4. Зберігає хеш пароля (не зберігає пароль у відкритому вигляді)
5. Встановлює статус "Верифіковано"

#### 6. Автоматична авторизація

**Система:**
1. Автоматично авторизує клієнта
2. Генерує токен сесії
3. Перенаправляє на головну сторінку особистого кабінету

### Післяумови
- Створено обліковий запис клієнта
- Номер телефону верифіковано
- Клієнт авторизований та має доступ до кабінету

---

## Сценарій 2: Авторізація існуючого користувача

### Опис
Зареєстрований клієнт входить до особистого кабінету.

### Послідовність дій

#### 1. Введення облікових даних

**Клієнт:**
1. Відкриває веб-сайт або мобільний додаток
2. Обирає "Вхід" / "Авторизація"
3. Вводить логін (номер телефону або email)
4. Вводить пароль
5. Натискає "Увійти"

**Опції:**
- "Запам'ятати мене" (зберегти сесію)
- "Забули пароль?" (посилання на відновлення)

#### 2. Перевірка облікових даних

**Система:**
1. Шукає обліковий запис за вказаним логіном
2. Перевіряє відповідність пароля (порівняння хешів)
3. Перевіряє статус облікового запису (не заблокований)

**Результати перевірки:**

**Варіант А: Дані вірні**
- Генерується токен сесії
- Клієнт перенаправляється до кабінету

**Варіант Б: Невірний пароль**
- Відображається помилка: "Невірний логін або пароль"
- Збільшується лічильник невдалих спроб
- Пропонується "Відновити пароль"
- Після 5 невдалих спроб - тимчасове блокування (15 хвилин)

**Варіант В: Обліковий запис не знайдено**
- Відображається помилка: "Невірний логін або пароль"
- Пропонується "Зареєструватися"

#### 3. Успішна авторизація

**Система:**
1. Створює сесію користувача
2. Зберігає токен у cookies/local storage
3. Завантажує дані профілю клієнта
4. Відображає головну сторінку кабінету

### Післяумови
- Клієнт авторизований
- Сесія активна
- Доступ до всіх функцій кабінету

---

## Сценарій 3: Відновлення пароля

### Опис
Клієнт забув пароль і потребує його відновлення.

### Послідовність дій

1. Клієнт натискає "Забули пароль?" на екрані авторізації
2. Вводить номер телефону або email
3. Система надсилає код підтвердження (SMS/Email)
4. Клієнт вводить код
5. Система пропонує встановити новий пароль
6. Клієнт вводить новий пароль двічі
7. Система зберігає новий пароль та автоматично авторизує

---

## Сценарій 4: Використання особистого кабінету

### Опис
Авторизований клієнт працює з різними розділами кабінету.

### Головна сторінка (Dashboard)

**Відображається:**
- Привітання з ім'ям клієнта
- Швидкий доступ до ключових розділів
- Актуальна інформація:
  - Найближче майбутнє бронювання
  - Баланс депозиту
  - Баланс активних бонусів
  - Рівень у програмі лояльності
- Останні покупки (3-5 останніх)

---

### Розділ 1: Профіль

#### Функції:
- Перегляд персональних даних
- Редагування персональних даних
- Зміна пароля

#### Детальний процес редагування

**Клієнт:**
1. Переходить до розділу "Профіль"
2. Система відображає поточні дані (read-only режим)
3. Клієнт натискає "Редагувати"
4. Поля стають доступними для редагування

**Доступні для редагування поля:**
- Ім'я та Прізвище
- Email
- Дата народження
- Номер телефону (з повторною верифікацією)

**Недоступні для редагування:**
- Номер картки/браслета (тільки адміністратор)
- Баланси
- Історія покупок

**Процес зміни номера телефону:**
1. Клієнт вводить новий номер телефону
2. Система надсилає SMS з кодом на НОВИЙ номер
3. Клієнт вводить код підтвердження
4. Система оновлює номер телефону після верифікації

**Збереження змін:**
1. Клієнт натискає "Зберегти"
2. Система валідує дані
3. Оновлює профіль
4. Відображає повідомлення про успіх
5. Синхронізує зміни з основною системою

---

### Розділ 2: Історія візитів та покупок

#### Відображається:

**Список візитів:**
- Дата та час візиту
- Тип візиту (сауна, масаж, басейн тощо)
- Тривалість
- Загальна сума

**Для кожного візиту:**
- Деталі покупок (позиції чеку)
- Застосовані знижки
- Використані бонуси
- Нараховані бонуси
- Посилання на фіскальний чек

**Фільтри:**
- За періодом (тиждень, місяць, рік, довільний)
- За типом послуги
- За сумою

**Сортування:**
- За датою (нові/старі)
- За сумою

---

### Розділ 3: Баланси

#### 3.1 Баланс депозиту

**Відображається:**
- Поточний баланс депозиту
- Історія поповнень:
  - Дата поповнення
  - Сума
  - Спосіб оплати
- Історія використання:
  - Дата
  - Сума списання
  - Номер чеку
  - Залишок після операції

#### 3.2 Баланси бонусів

**Відображається:**
- **Активні бонуси:**
  - Кількість
  - Еквівалент у гривнях
  - Термін дії (якщо обмежений)

- **Неактивні бонуси:**
  - Кількість
  - Дата активації
  - Після якої дати стануть доступними

- **Історія нарахувань:**
  - Дата
  - Кількість нарахованих бонусів
  - За яку покупку
  - Статус (активні/очікують)

- **Історія списань:**
  - Дата
  - Кількість списаних бонусів
  - Номер чеку
  - Залишок після списання

**Рівень лояльності:**
- Поточний рівень
- Відсоток нарахування
- До наступного рівня (скільки ще витратити)
- Прогрес-бар

---

### Розділ 4: Бронювання

#### 4.1 Майбутні візити

**Відображається:**
- Дата та час бронювання
- Тип послуги
- Спеціаліст (якщо призначено)
- Приміщення/зона
- Статус (Підтверджено / Очікує підтвердження)

**Дії:**
- Переглянути деталі
- Скасувати бронювання (якщо дозволено)
- Перенести (якщо доступно)

#### 4.2 Минулі візити

**Відображається:**
- Архів виконаних бронювань
- Деталі наданих послуг
- Можливість повторити бронювання

---

### Розділ 5: Фіскальні чеки

#### Функції:
- Перегляд списку всіх фіскальних чеків
- Деталі кожного чеку
- Завантаження чеку (PDF/зображення)

**Список чеків:**
- Дата та час
- Номер чеку
- Загальна сума
- Фіскальний номер

**Деталі чеку:**
- Всі позиції
- Кількість та ціни
- Знижки та бонуси
- ПДВ
- QR-код для перевірки

**Завантаження:**
- Формат PDF
- Відправка на email
- Відображення QR-коду для перевірки у податковій

---

## Сценарій 5: Вихід з кабінету

### Послідовність дій

1. Клієнт обирає "Вийти"
2. Система запитує підтвердження
3. Після підтвердження:
   - Знищує токен сесії
   - Очищає локальне сховище (якщо не обрано "Запам'ятати")
   - Перенаправляє на сторінку входу

---

## Технічні вимоги

### Безпека

**Авторизація:**
- HTTPS для всіх з'єднань
- Хешування паролів (bcrypt, scrypt)
- Токени сесії з обмеженим терміном дії
- Захист від CSRF-атак
- Захист від SQL-ін'єкцій

**Обмеження:**
- Лічильник невдалих спроб входу
- Тимчасове блокування після 5 невдалих спроб
- Rate limiting для API

**Приватність:**
- Відповідність GDPR (якщо застосовно)
- Шифрування персональних даних
- Право на видалення облікового запису

### Продуктивність

**Швидкодія:**
- Час завантаження головної сторінки < 2 секунд
- Відгук на дії користувача < 300 мс
- Оптимізація запитів до API

**Кешування:**
- Кешування статичних даних (профіль, баланси)
- Автоматичне оновлення при змінах

### Адаптивність

**Підтримка пристроїв:**
- Десктоп (всі сучасні браузери)
- Планшет
- Мобільний телефон

**Responsive design:**
- Адаптація інтерфейсу під розмір екрана
- Touch-friendly елементи на мобільних

---

## Інтеграції

### API основної системи

**Синхронізація даних:**
- Real-time або near real-time
- Двосторонній обмін даними
- Автентифікація через токени

**Методи API:**
- `GET /profile` - отримати профіль клієнта
- `PUT /profile` - оновити профіль
- `GET /history` - історія візитів
- `GET /balances` - баланси депозиту та бонусів
- `GET /bookings` - бронювання
- `GET /receipts` - фіскальні чеки
- `POST /auth/login` - авторизація
- `POST /auth/register` - реєстрація
- `POST /auth/verify` - верифікація коду

### SMS Gateway

- Відправка кодів підтвердження
- Нагадування про бронювання
- Повідомлення про нарахування бонусів

### Email

- Підтвердження реєстрації
- Відновлення пароля
- Чеки на email
- Newsletters (за згодою)

---

## Альтернативні потоки

### Номер телефону вже зареєстровано

**Під час реєстрації:**
- Система виявляє, що номер вже існує
- Повідомляє: "Цей номер вже зареєстровано"
- Пропонує авторизуватися або відновити пароль

### Втрата інтернет-з'єднання

**Під час роботи:**
- Система відображає повідомлення про втрату з'єднання
- Зберігає введені дані локально (якщо можливо)
- Після відновлення з'єднання пропонує повторити операцію

### Зміна даних в основній системі

**Адміністратор змінив дані клієнта:**
- При наступному вході клієнт бачить оновлені дані
- Система може надіслати повідомлення про зміни

---

## Виняткові ситуації

### Помилка API

- Відображення зрозумілого повідомлення користувачу
- Пропозиція повторити спробу
- Логування помилок для адміністраторів

### Невідповідність даних

- Якщо дані в порталі не збігаються з основною системою
- Пріоритет даних основної системи
- Автоматична синхронізація

---

## Метрики успішності

**Користування:**
- Кількість зареєстрованих користувачів
- DAU (Daily Active Users)
- MAU (Monthly Active Users)
- Відсоток клієнтів, що користуються порталом

**Engagement:**
- Середня тривалість сесії
- Кількість переглянутих сторінок
- Найпопулярніші розділи

**Технічні:**
- Час завантаження сторінок
- Відсоток помилок API
- Uptime порталу (цільовий: 99.9%)

**Конверсія:**
- Відсоток завершених реєстрацій
- Відсоток успішних авторізацій

---

## Переваги для клієнтів

1. **Зручність:** Доступ до інформації 24/7 з будь-якої точки
2. **Прозорість:** Повна історія покупок та візитів
3. **Контроль:** Самостійне управління профілем
4. **Економія часу:** Швидкий доступ до чеків, балансів
5. **Інформованість:** Актуальні дані про бонуси та депозит

## Переваги для бізнесу

1. **Зниження навантаження:** Менше запитів на рецепцію
2. **Лояльність:** Покращення клієнтського досвіду
3. **Дані:** Збір аналітики поведінки користувачів
4. **Автоматизація:** Самообслуговування клієнтів
5. **Маркетинг:** Канал комунікації з клієнтами
