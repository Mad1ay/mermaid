# UC-FR6.1.6: Управління бонусною системою

## Загальна інформація

**Об'єднує наступні Use Cases:**
- **UC-FR6.1.6.1:** Автоматичне нарахування бонусів за покупки
- **UC-FR6.1.6.2:** Використання бонусів для оплати

**Актори:**
- Система (автоматичне нарахування)
- Клієнт (через Адміністратора рецепції - використання)

**Тип:** Use Case

## Загальний опис

Повний цикл управління програмою лояльності через бонусну систему. Включає автоматичне нарахування бонусів на рахунок клієнта після кожної покупки згідно з правилами програми та можливість використання накопичених бонусів для повної або часткової оплати товарів/послуг з урахуванням встановлених обмежень.

---

# UC-FR6.1.6.1: Автоматичне нарахування бонусів за покупки

## Опис

Автоматичне нарахування бонусів на рахунок клієнта після кожної покупки згідно з правилами програми лояльності. Система враховує рівень клієнта, виключає товари-винятки та може застосовувати відкладену активацію бонусів.

## Передумови

- Програма лояльності налаштована в системі
- Визначені рівні лояльності з відсотками нарахування
- Клієнта ідентифіковано під час продажу
- Клієнт є учасником програми лояльності

## Тригер

Успішне закриття чеку (завершення оплати замовлення)

## Детальний потік

### 1. Ініціація нарахування

**Автоматична дія після закриття чеку:**
1. Система фіксує завершення транзакції
2. Перевіряє, чи було ідентифіковано клієнта під час продажу
3. Якщо клієнт ідентифікований - переходить до перевірки участі в програмі
4. Якщо ні - завершує процес без нарахування

### 2. Перевірка участі в програмі лояльності

**Система перевіряє:**
- Чи є клієнт учасником програми лояльності
- Чи активний його статус учасника
- Чи не заблокована програма для цього клієнта

**Результати:**
- **Клієнт - учасник:** Продовження процесу нарахування
- **Клієнт не є учасником:** Завершення без нарахування

### 3. Фільтрація товарів-винятків

**Система аналізує склад чеку:**

Виключає з бази нарахування:
- Акційні товари (якщо налаштовано)
- Тютюнові вироби
- Алкогольні напої (якщо налаштовано)
- Товари з категорії "без бонусів"
- Сертифікати та подарункові картки
- Інші товари згідно з налаштуваннями

**Приклад:**
- Загальна сума чеку: 1000 грн
- З них акційні товари: 300 грн
- Тютюн: 100 грн
- **База для нарахування бонусів: 600 грн**

### 4. Визначення рівня клієнта

**Система отримує:**
- Поточний рівень лояльності клієнта
- Відсоток нарахування для цього рівня

**Приклад рівнів:**
- Базовий: 5% бонусів
- Срібний: 7% бонусів
- Золотий: 10% бонусів
- Платиновий: 15% бонусів

### 5. Розрахунок кількості бонусів

**Формула:**
```
Бонуси до нарахування = База нарахування × (Відсоток рівня / 100)
```

**Приклад:**
- База нарахування: 600 грн
- Рівень клієнта: Золотий (10%)
- **Розрахунок: 600 × 0.10 = 60 бонусів**

### 6. Застосування відкладеної активації (опціонально)

**Система перевіряє налаштування:**

**Варіант А: Без відкладеної активації**
- Бонуси одразу стають активними
- Клієнт може використати їх негайно

**Варіант Б: З відкладеною активацією**
- Бонуси нараховуються зі статусом "Очікують активації"
- Вказується дата активації (наприклад, через 14 днів)
- До дати активації бонуси не можна використати
- Після дати активації статус автоматично змінюється на "Активні"

**Мета відкладеної активації:**
- Захист від шахрайства (повернення товару)
- Стимулювання повторних відвідувань
- Зменшення ризиків для бізнесу

### 7. Нарахування бонусів

**Система виконує:**
1. Додає розраховану кількість бонусів на рахунок клієнта
2. Встановлює відповідний статус (Активні / Очікують активації)
3. Фіксує дату нарахування
4. Зберігає посилання на чек/транзакцію
5. Фіксує базу нарахування та застосований відсоток

### 8. Оновлення балансу

**Система оновлює:**
- Баланс активних бонусів (якщо без відкладення)
- Баланс неактивних бонусів (якщо з відкладенням)
- Загальну кількість нарахованих бонусів за весь час
- Історію операцій з бонусами

## Післяумови

- Бонуси нараховані на рахунок клієнта
- Баланс бонусів оновлено
- Транзакція нарахування зафіксована
- Клієнт може переглянути нараховані бонуси

## Альтернативні потоки

### Весь чек складається з товарів-винятків

**Сценарій:**
- Клієнт купив тільки акційні товари
- База нарахування = 0 грн
- **Результат:** Бонуси не нараховуються

### Клієнт не є учасником програми

**Сценарій:**
- Клієнт не зареєстрований в програмі лояльності
- **Результат:** Бонуси не нараховуються
- **Можливість:** Запропонувати реєстрацію в програмі

---

# UC-FR6.1.6.2: Використання бонусів для оплати

## Опис

Використання накопичених бонусів для повної або часткової оплати товарів/послуг з дотриманням встановлених обмежень на товари та максимальний відсоток оплати чеку бонусами.

## Передумови

- Клієнта ідентифіковано
- На бонусному рахунку є активні бонуси (достатня кількість)
- Сформовано замовлення для оплати

## Детальний потік

### 1. Ініціація використання бонусів

**Під час процесу оплати:**
1. Клієнт висловлює бажання використати бонуси
2. Адміністратор рецепції обирає опцію "Оплата бонусами"
3. Система відображає інформацію про бонуси клієнта

### 2. Перевірка та відображення балансу

**Система показує:**
- Загальний баланс бонусів
- Кількість активних бонусів (доступні для використання)
- Кількість неактивних бонусів (очікують активації)
- Еквівалент бонусів у гривнях (1 бонус = X грн)

**Приклад відображення:**
```
Активні бонуси: 500 (= 500 грн)
Очікують активації: 150 (доступні з 25.12.2024)
Загальний баланс: 650 бонусів
```

### 3. Введення суми бонусів до списання

**Адміністратор рецепції:**
- Вводить кількість бонусів, які клієнт бажає використати
- Або обирає "Використати максимум"

**Система:**
- Перевіряє введену кількість
- Конвертує бонуси в гривні за встановленим еквівалентом

### 4. Валідація обмежень

**Система виконує серію перевірок:**

#### Перевірка 1: Достатність бонусів

**Умова:** Чи достатньо активних бонусів для списання?

**Якщо недостатньо:**
1. Система відображає помилку
2. Показує максимально доступну кількість
3. Пропонує використати весь доступний баланс

**Приклад:**
- Клієнт хоче списати: 600 бонусів
- Доступно: 500 бонусів
- **Дія:** Помилка + пропозиція списати 500

#### Перевірка 2: Обмеження на товари

**Умова:** Чи є в чеку товари, на які не можна використовувати бонуси?

**Товари-винятки для оплати бонусами:**
- Тютюнові вироби
- Акційні товари
- Товари з категорії "без знижок"
- Алкоголь (якщо налаштовано)

**Якщо є заборонені товари:**
1. Система виключає їх вартість з бази для оплати бонусами
2. Перераховує максимальну суму, яку можна оплатити бонусами

**Приклад:**
- Сума чеку: 1000 грн
- З них тютюн: 200 грн
- **Максимум для оплати бонусами: 800 грн**

#### Перевірка 3: Відсоток від чеку

**Умова:** Чи не перевищує сума бонусів дозволений % від чеку?

**Типові обмеження:**
- Максимум 50% суми чеку
- Або максимум 70% суми чеку
- Або без обмежень (100%)

**Якщо перевищує:**
1. Система автоматично коригує суму
2. Розраховує максимально дозволену кількість бонусів
3. Повідомляє адміністратора про автоматичне коригування

**Приклад:**
- Сума чеку: 1000 грн
- Обмеження: максимум 50%
- Клієнт хоче списати: 700 бонусів (700 грн)
- **Система коригує до: 500 бонусів (500 грн = 50%)**

### 5. Автоматичне коригування

**Якщо виявлено порушення обмежень:**

**Система:**
1. Розраховує максимально дозволену суму автоматично
2. Коригує кількість бонусів до допустимої
3. Відображає повідомлення адміністратору:
   ```
   Увага! Сума бонусів скоригована до 500 (максимум 50% від чеку).
   Клієнт може використати 500 бонусів замість 700.
   ```

**Адміністратор:**
- Інформує клієнта про коригування
- Підтверджує використання скоригованої суми

### 6. Списання бонусів

**Після успішної валідації:**

1. Система списує затверджену кількість бонусів
2. Зменшує баланс активних бонусів
3. Фіксує транзакцію списання:
   - Дата та час
   - Кількість списаних бонусів
   - Номер чеку/замовлення
   - Співробітник

### 7. Зменшення суми до оплати

**Система:**
1. Конвертує списані бонуси в гривні
2. Віднімає цю суму від загальної суми чеку
3. Відображає оновлену суму до оплати

**Приклад:**
- Сума чеку: 1000 грн
- Списано бонусів: 500 (= 500 грн)
- **Залишок до оплати: 500 грн**

### 8. Завершення оплати

**Далі:**
- Клієнт оплачує залишок іншим методом (готівка/картка)
- Або якщо бонусів вистачило на всю суму - оплата завершена
- Система друкує фіскальний чек з відміткою про використання бонусів

## Післяумови

- Бонуси списані з рахунку клієнта
- Баланс бонусів оновлено
- Сума до оплати зменшена або повністю сплачена
- Транзакція списання зафіксована
- У фіскальному чеку відображено використання бонусів

## Альтернативні потоки

### Недостатньо бонусів

**Сценарій:**
- Клієнт хоче використати 1000 бонусів
- Доступно лише 300

**Дії:**
1. Система показує помилку: "Недостатньо бонусів. Доступно: 300"
2. Пропонує використати всі 300 бонусів
3. Адміністратор підтверджує
4. Решту клієнт оплачує іншим методом

### Порушення обмеження на % від чеку

**Сценарій:**
- Сума чеку: 600 грн
- Обмеження: максимум 50%
- Клієнт має 500 бонусів і хоче використати всі

**Дії:**
1. Система автоматично коригує: 600 × 0.5 = 300 грн = 300 бонусів
2. Повідомляє: "Використано максимум: 300 бонусів (50% від чеку)"
3. Списує 300 бонусів
4. Залишок до оплати: 300 грн

### Весь чек - товари-винятки

**Сценарій:**
- Клієнт купує тільки тютюн на 500 грн
- Тютюн не можна оплачувати бонусами

**Дії:**
1. Система блокує використання бонусів
2. Повідомляє: "Бонуси не можна використати для цих товарів"
3. Клієнт оплачує іншим методом

---

# Загальні бізнес-правила бонусної системи

## Еквівалент бонусу

- Зазвичай: 1 бонус = 1 грн
- Може бути налаштовано інакше (1 бонус = 0.5 грн тощо)
- Єдиний еквівалент для всієї системи

## Рівні лояльності

**Типова структура:**

| Рівень | Накопичена сума покупок | % нарахування бонусів |
|--------|-------------------------|----------------------|
| Базовий | 0 - 5,000 грн | 5% |
| Срібний | 5,001 - 15,000 грн | 7% |
| Золотий | 15,001 - 30,000 грн | 10% |
| Платиновий | 30,001+ грн | 15% |

## Відкладена активація

- Термін відкладення: налаштовується (типово 14 днів)
- Мета: захист від повернень та шахрайства
- Після дати активації бонуси автоматично стають активними

## Термін дії бонусів

- Можуть бути безстроковими
- Або з терміном дії (наприклад, 1 рік з дати нарахування)
- Система автоматично списує прострочені бонуси

## Товари-винятки

**Для нарахування:**
- Акційні товари
- Тютюн
- Алкоголь (опціонально)
- Подарункові сертифікати

**Для використання (додатково до вищезазначених):**
- Товари з мінімальною націнкою
- Вже знижені товари

## Обмеження використання

- Максимальний % від чеку: налаштовується (типово 50-70%)
- Мінімальна сума чеку для використання бонусів (опціонально)
- Заборона комбінування з певними знижками (опціонально)

## Пов'язані Use Cases

- UC-FR6.1.1: Управління профілем клієнта
- UC-FR6.1.6.3: Автоматичний перехід на вищий рівень програми лояльності
- UC-FR6.1.6.4: Налаштування правил бонусної системи
- UC-FR6.3.2: Застосування знижок та лояльності
- UC-FR6.3.3: Обробка оплати замовлення

## Звітність

### Звіти по бонусній системі

- Загальна кількість нарахованих бонусів за період
- Загальна кількість списаних бонусів за період
- Баланс активних бонусів (загалом по всіх клієнтах)
- Розподіл клієнтів по рівнях лояльності
- ТОП клієнтів за балансом бонусів
- Ефективність програми лояльності (ROI)

## Метрики успішності

- Відсоток клієнтів - учасників програми (цільовий: > 80%)
- Середній баланс бонусів на одного клієнта
- Коефіцієнт використання бонусів (списані / нараховані)
- Вплив на повторні покупки (retention rate)
- Збільшення середнього чеку учасників програми vs неучасників

## Переваги для бізнесу

1. **Підвищення лояльності:** Стимулювання повторних покупок
2. **Збільшення чеку:** Клієнти купують більше для отримання бонусів
3. **База даних:** Збір інформації про клієнтів
4. **Аналітика:** Розуміння поведінки та переваг клієнтів
5. **Конкурентна перевага:** Диференціація від конкурентів
6. **Відкладене зобов'язання:** Бонуси спонукають повернутися
